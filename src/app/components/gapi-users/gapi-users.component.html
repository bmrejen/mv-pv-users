<h1>Google</h1>

<div>
    <div>API is loaded : {{ apiLoaded }}</div>
    <div>API is failed : {{ apiFailed }}</div>
    <div>API is ready : {{ apiReady }}</div>
    <div>User logged in : {{ userLoggedIn }}</div>
    <br>
    <button
        *ngIf="userLoggedIn==='Logged out'"
        (click)="signIn()"
    >Sign In</button>

    <div *ngIf="userLoggedIn!=='Logged out'">
        <button (click)="signIn()">Change Users</button>
        <button (click)="signOut()">Sign Out</button>
        <button (click)="listUsers()">List Users</button>
        <button (click)="resetForm()">New User</button>
        <br>
        Email or alias of user to get (ex. bmrejen@marcovasco.fr)
        <br>
        <input
            type="text"
            name="userToGet"
            [(ngModel)]="userToGet"
        >
        <button (click)="getUser(userToGet)">Get</button>
        <span *ngIf="isAlias">THIS EMAIL IS AN ALIAS OF {{ currentUser.primaryEmail | uppercase }}</span>
        <span *ngIf="isAlias === false">Email belongs to real account</span>
        <hr>

        <input
            type="text"
            name="firstName"
            [(ngModel)]="currentUser.givenName"
        >First name
        <br>
        <input
            type="text"
            name="lastName"
            [(ngModel)]="currentUser.familyName"
        >Last name
        <br>
        <input
            type="text"
            name="password"
            [(ngModel)]="currentUser.password"
        >Password
        <br>
        <select
            name="orgas"
            [(ngModel)]="currentUser.orgas"
        >
            <option
                *ngFor="let orga of orgas"
                [value]="orga.value"
            >{{ orga.value }}
            </option>
        </select>Orgas
        <div
            *ngIf="googleGroups != null"
            class="googleGroups"
        >Google Groups
            <div *ngFor="let group of googleGroups; trackBy: trackByFn">
                <label>
                    <input
                        type="checkbox"
                        [checked]="group.isEnabled"
                        (change)="pushGroupToUser(group)"
                    >{{ group.name }} ({{ group.directMembersCount }})
                </label>
            </div>
        </div>
        <fieldset>
            <legend>GMail</legend>
            <select
                name="sendAs"
                [(ngModel)]="currentUser.sendAs"
            >
                <option
                    *ngFor="let dom of domains"
                    [value]="dom"
                >{{ dom }}</option>
            </select>Default Send-as email
            <br>
            Signature <br>
            <textarea
                name="signature"
                [(ngModel)]="currentUser.signature"
                cols="150"
                rows="10"
            ></textarea>
        </fieldset>

        <hr>

        <div *ngIf="currentUser.id != null">
            <input
                type="text"
                name="id"
                [(ngModel)]="currentUser.id"
                [attr.disabled]="true"
            >ID
            <br>

            <input
                type="text"
                name="primaryEmail"
                [(ngModel)]="currentUser.primaryEmail"
                [disabled]="currentUser.id != null"
            >Primary Mail
            <br>
            Other Emails
            <div *ngFor="let email of currentUser.emails">
                <input
                    type="text"
                    [value]="email.address"
                    [attr.disabled]="true"
                >
            </div>
            <button (click)="updateUser()">Update</button>
            <button (click)="activateImap()">Activate IMAP</button>
            <button (click)="deactivateImap()">Deactivate IMAP</button>
        </div>


        <button
            *ngIf="currentUser.id == null"
            (click)="postUser()"
        >Create</button>
    </div>

    <h2 *ngIf="message != null">{{ message }}</h2>
    <pre> {{ currentUser | json }} </pre>
    <table *ngIf="users != null && users.length > 0">
        <thead>
            <tr>
                <th>ID</th>
                <th>First name</th>
                <th>Last name</th>
                <th>Is Admin</th>
                <th>Team</th>
                <th>Primary Email</th>
                <th>Emails</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let user of users; trackBy: trackByFn">
                <td>{{ user.id }}</td>
                <td>{{ user.name.givenName }}</td>
                <td>{{ user.name.familyName }}</td>
                <td>{{ user.isAdmin }}</td>
                <td>{{ user.orgUnitPath }}</td>
                <td>{{ user.primaryEmail }}</td>
                <td>
                    <ul *ngIf="user.emails && user.emails != null">
                        <li *ngFor="let email of user.emails; trackBy: trackByFn">
                            {{ email.address }}
                        </li>
                    </ul>
                </td>
            </tr>
        </tbody>
    </table>
